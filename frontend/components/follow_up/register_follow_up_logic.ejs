<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
<script>
    document.addEventListener("DOMContentLoaded", () => {

    // Si get_info necesita el texto del botón, puedes modificarla para recibirlo como parámetro
    function get_info(selectedOption) {
      console.log("Ejecutando get_info con opción:", selectedOption);
      
      // Seleccionar el contenedor donde se mostrará el contenido
      const contentContainer = document.getElementById("content-section");
      if (selectedOption == 'Register'){
        contentContainer.innerHTML = `
          <div class="column-container">
            <section class='column'>
              <div>
                <label class="is-size-6 styling" for="collaborators">Employee</label>
                <select id="collaborators" class="line-input text-style" name="select-collab">
                  <option value="default" disabled selected>Select Collaborator</option>
                  <% if (colaboradores.length > 0) { %>
                    <% for (let i = 0; i < colaboradores.length; i++) { %>
                      <option value="<%= colaboradores[i].id %>">
                        <%= colaboradores[i].nombre + " " + colaboradores[i].apellidos %>
                      </option>
                    <% } %>
                  <% } else { %>
                        <option disabled> No hay colaboradores disponibles </option>
                  <% } %>
                </select>
              </div>  

          
              <div>
                <label class="is-size-6 text-style styling">Date</label>
                <input class="dateLine" type="date" id="filter_end"/>
              </div>
              
              <div>
                <% for(let i = 0; i < questions.length; i++) { %>
                  <div class="container">
                    <p class="line-questions">
                      <span> <%= questions[i].pregunta %> </span>
                      <i class="bi bi-caret-down-fill"></i>
                    </p>
                  </div>
                <% } %> 
              </div>
                
            </section>

            <section class='column'>

              <container class="radar-container">
                <canvas id="myRadarChart"></canvas>
              </container>

              <div>
                <% for(let i = 0; i < indicator.length; i++) { %>
                  <div class="container">
                    <p class="progress-text"> <%= indicator[i].indicador %> </p>
                    <input class="progress-bar" type="range" id="progressInput" min="0" max="5" value="3">
                    <div class="numbers-container">
                      <div class="numbers">
                        <p> 0 </p>
                      </div>
                      <div class="numbers">
                        <p> 1 </p>
                      </div>
                      <div class="numbers">
                        <p> 2 </p>
                      </div>
                      <div class="numbers">
                        <p> 3 </p>
                      </div>
                      <div class="numbers">
                        <p> 4 </p>
                      </div>
                      <div class="numbers">
                        <p> 5 </p>
                      </div>
                    </div>
                  </div>
                <% } %> 
              </div>

              <div class="button-container">
                <button class="approve-button" type="button"> Submit </button>
              </div>
            </section>
          </div>    
        `;

        const progressBars = document.querySelectorAll(".progress-bar");
        console.log(progressBars);
        const progressTexts = document.querySelectorAll(".progress-text");
        console.log(progressTexts);
        const indicatorLabels = [];
        for (let i = 0; i < progressTexts.length; i++){
          indicatorLabels.push(progressTexts[i].textContent.trim());
        }
        console.log(indicatorLabels);

        let indicatorValues = new Array(indicatorLabels.length).fill(0);
        console.log(indicatorValues);

        const ctx = document.getElementById("myRadarChart").getContext("2d");
        console.log(ctx);
        const radar = new Chart(ctx, { 
          data: {
            labels: indicatorLabels,
            datasets: [{
              label: "Radar Graph",
              data: indicatorValues,
              backgroundColor: "#FFFF",
              borderColor: "#EEEEEE",
              borderWidth: 1,
            }]
          },
          options:{
            scales:{
              r:{
                backgroundColor: "#FFFF",
                hoverBackgroundColor: "#767574",
                angleLines: { display: true },
                suggestedMin: 0,
                suggestedMax: 5
              }
            }
          }
        });

        function updateChart(){
          console.log('update', radar.data.datasets[0].data = indicatorValues);
          radar.update();
        };

        function updateValues(){
          for (let i = 0; i < progressBars.length; i++){
            indicatorValues[i] = parseInt(progressBars[i].value); 
            console.log('values',indicatorValues);
          }
          updateChart(); 
        };

        for(let i = 0; i < progressBars.length ; i++){
          progressBars[i].addEventListener('input', updateValues);
          console.log('progress', progressBars[i]);
        };


      }
    }

    // Manejo de selección de pestañas de los botones
    document.querySelectorAll(".option").forEach(option => {
      option.addEventListener("click", (event) => {
        // Eliminar la clase 'selected' de todos
        document.querySelectorAll(".option").forEach(el => el.classList.remove("selected"));

        // Agregar la clase 'selected' al botón clickeado
        option.classList.add("selected");

        // Obtener y mostrar el contenido del botón
        const buttonText = option.textContent.trim();
        console.log("Botón seleccionado:", buttonText);

        // Puedes hacer algo con buttonText, como pasarlo a otra función
        get_info(buttonText);
      });
    });
    
   
  });
</script>
