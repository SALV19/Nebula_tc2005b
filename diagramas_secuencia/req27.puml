@startuml REQ_27
autonumber
actor SuperAdmin as S
boundary general.routes.json as SRoute
boundary approve_requests.ejs as Requests
control requests.controller.js as SController
entity SolicitudesFalta.model as SModel
database Nebula as db

' ---- CONSULTAR SOLICITUDES ----
activate S
S -> SRoute : Get /requests
deactivate S

activate SRoute
SRoute -> SController : get_requests()
deactivate SRoute

activate SController
SController -> SModel : getRequests()
deactivate SController

activate SModel 
SModel -> db : SELECT * FROM Solicitudes_Falta ORDER BY estado ASC
activate db
db -->> SModel : rows
deactivate db

SModel -->> SController : Requests List
deactivate SModel

activate SController
SController -> Requests : response.render('approve_requests.ejs', { requestsList })
deactivate SController

activate Requests
Requests -> S : HTML approve_requests.ejs
deactivate Requests

' ---- APROBAR SOLICITUD ----
activate S
S -> SRoute : POST /requests
deactivate S

activate SRoute
SRoute -> SController : post_approve_requests(requests_id)
deactivate SRoute

activate SController 
create SModel
SController -> SModel : new SolicitudesFalta(request_id)
SController -> SModel : approveRequest()

activate SModel
SModel -> db : UPDATE Solicitudes_Falta SET estado = 1 WHERE id = request_id
activate db
db -->> SModel : Query OK (Rows Affected)
deactivate db

SModel -->> SController : resolve('Success') / reject('Error')
deactivate SModel

SController -> Requests : response.render('approve_requests.ejs', { requestsList })
deactivate SController

activate Requests
Requests -> S : HTML approve_requests.ejs
deactivate Requests

activate S
@enduml
